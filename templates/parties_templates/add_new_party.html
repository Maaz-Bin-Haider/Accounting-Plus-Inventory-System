
{% extends "base/base.html" %}

{% block title %}Add New Party{% endblock title %}
{% block body %}
    <h1>Add New Party</h1>
    <!-- ------------------------------Party Form----------------------------------------------------- -->
    <div id="create_party_container">
        <form  id="create_party_form" method="post">
        {% csrf_token %}
        <!-- Party Name -->
        <label for="party_name">Party Name:</label>
        <input type="text" id="party_name" name="party_name" placeholder="Enter party name" required><br><br>

        <!-- Party Type -->
        <label for="party_type">Party Type:</label>
        <select id="party_type" name="party_type">

            <option value="Both">Both</option>
            <option value="Expense">Expense</option>
        </select><br><br>

        <!-- Contact Info -->
        <label for="contact_info">Contact Info:</label>
        <input type="text" id="contact_info" name="contact_info" placeholder="e.g. 123-456789"><br><br>

        <!-- Address -->
        <label for="address">Address:</label><br>
        <textarea id="address" name="address" rows="3" cols="40" placeholder="Enter address"></textarea><br><br>

        <!-- Opening Balance -->
        <label for="opening_balance">Opening Balance:</label>
        <input type="number" id="opening_balance" name="opening_balance" value=0 ><br><br>

        <!-- Balance Type -->
        <label for="balance_type">Balance Type:</label>
        <select id="balance_type" name="balance_type">
            <option value="Debit">Debit</option>
            <option value="Credit">Credit</option>
        </select><br><br>

        <!-- Submit -->
        <button type="submit" class="create_party_btn">Save</button>
        </form>
    </div>
    <!-- SweetAlert2 -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
    document.getElementById("create_party_form").addEventListener("submit", function(e) {
        e.preventDefault();

        const form = e.target;
        const formData = new FormData(form);

        fetch("", {
            method: "POST",
            body: formData,
            headers: { "X-CSRFToken": form.querySelector('[name=csrfmiddlewaretoken]').value }
        })
        .then(response => response.json())
        .then(data => {
            if (data.status === "success") {
                Swal.fire({
                    icon: "success",
                    title: "Success",
                    text: data.message,
                    showConfirmButton: false,   // ðŸ”¹ No confirm button
                    timer: 2500,                // ðŸ”¹ Auto close after 1.5s
                    timerProgressBar: true
                }).then(() => {
                    location.reload();          // ðŸ”¹ Reload page
                });
            } else {
                Swal.fire({
                    icon: "error",
                    title: "Error",
                    text: data.message,
                    confirmButtonColor: '#3085d6'  // ðŸ”¹ Has confirm button
                });
            }
        })
        .catch(() => {
            Swal.fire({
                icon: "error",
                title: "Error",
                text: "Something went wrong while submitting the form.",
                confirmButtonColor: '#d33'
            });
        });
    });
</script>
{% endblock body %}