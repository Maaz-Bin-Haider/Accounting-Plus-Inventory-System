{% extends "base/base.html" %}
{% load static %}



{% block title %} Payment {% endblock title %}

{% block SeperateCssFile %}
    <link rel="stylesheet" href="{% static 'css/payment.css' %}">
{% endblock SeperateCssFile %}




{% block body %}
<div class="dropdown-container">
    <button id="btnOldPayments">üìú Payments History</button>
    <button id="btnVendorPayments">üìÖ Payments Date-Wise</button>
</div>


<form method='post' id="paymentForm">
    {% csrf_token %}
    <h2><span class="paymet-icon">üí≥</span> Payment</h2>
    
    <!-- top row: date + party -->
    <div class="form-row">
        <div class="form-group">
            <label for="payment_date">Payment Date</label>
            <input type="date" id="payment_date" name="payment_date" value="{{payment_date}}" required>
        </div>

        <div class="form-group autocomplete-container">
            <label for="search_name">Party Name:</label>
            <input type="text" id="search_name" name="search_name"
                   placeholder="Enter Party Name"
                   autocomplete="off"
                   data-autocomplete-url="{% url 'parties:autocomplete_party' %}"
                   value="{{party_name}}">
            <div id="suggestions"></div>
        </div>
    </div>

    <!-- stacked fields -->
    <div class="form-group">
        <label for="amount">Amount</label>
        <input type="number" id="amount" name="amount" placeholder="Enter Amount" value="{{amount}}" required>
    </div>

    <div class="form-group">
        <label for="method">Method</label>
        <input type="text" id="method" name="method" value="Cash" readonly>
    </div>

    <div class="form-group">
        <label for="description">Description</label>
        <textarea id="description" name="description" placeholder="Enter Description">{{description}}</textarea>
    </div>

    
    <div class="btn-row">
        <button type="submit" name="action" value="submit" class="save-and-update-btn">
            <i class="fa-solid fa-floppy-disk"></i>  Save Payment
        </button>
        
        <button type="submit" name="action" value="delete" class="delete-btn">
            <i class="fa-solid fa-trash"></i>  Delete
        </button>
    </div>
    

</form>


<input type="hidden" id="current_payment_id" name="current_id" value="{{payment_id}}" form="paymentForm">

<div class="button-group">
    <button type="button" onclick="navigatePayment('previous')"><i class="fa-solid fa-arrow-left"></i> Previous</button>
    <button type="button" onclick="navigatePayment('next')">Next <i class="fa-solid fa-arrow-right"></i></button>
</div>


<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="{% static 'js/payments_page.js' %}"></script>

{% if messages %}
<script>
document.addEventListener("DOMContentLoaded", function() {
    {% for message in messages %}
        {% if message.tags == 'success' %}
            // ‚úÖ Success message ‚Äî auto close
            Swal.fire({
                title: "Success!",
                text: "{{ message|escapejs }}",
                icon: "success",
                timer: 2500,
                showConfirmButton: false,
                timerProgressBar: true,
                didOpen: (popup) => {
                    popup.addEventListener('mouseenter', Swal.stopTimer)
                    popup.addEventListener('mouseleave', Swal.resumeTimer)
                }
            });
        {% elif message.tags == 'error' %}
            // ‚ö†Ô∏è Error message ‚Äî requires confirmation
            Swal.fire({
                title: "Error!",
                text: "{{ message|escapejs }}",
                icon: "error",
                confirmButtonColor: '#d33',
                confirmButtonText: 'OK'
            });
        {% else %}
            // ‚ÑπÔ∏è Info or other message ‚Äî requires confirmation
            Swal.fire({
                title: "Notice",
                text: "{{ message|escapejs }}",
                icon: "info",
                confirmButtonColor: '#3085d6',
                confirmButtonText: 'OK'
            });
        {% endif %}
    {% endfor %}
});
</script>

{% endif %}


{% endblock body %}

